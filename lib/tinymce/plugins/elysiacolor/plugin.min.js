tinymce.PluginManager.add("elysiacolor",function(c){function a(g){var f=null;c.dom.getParents(c.selection.getStart(),function(i){var h;if((h=i.getAttribute(g=="forecolor"?"color":"bgcolor"))||(h=i.style[g=="forecolor"?"color":"background-color"])){f=c.dom.toHex(h)}});if(!f&&c.selection.getEnd()&&c.selection.getEnd()!=c.selection.getStart()){c.dom.getParents(c.selection.getEnd(),function(i){var h;if((h=i.getAttribute(g=="forecolor"?"color":"bgcolor"))||(h=i.style[g=="forecolor"?"color":"background-color"])){f=c.dom.toHex(h)}})}if(!f){f=g=="forecolor"?"#000000":"#FFFFFF"}return f}function d(g,f){c.undoManager.transact(function(){c.focus();c.formatter.apply(g,{value:f});c.nodeChanged()})}function e(f){c.undoManager.transact(function(){c.focus();c.formatter.remove(f,{value:null},null,true);c.nodeChanged()})}function b(){var f=c.settings.color_picker_callback;if(f){return function(){var g=this;f.call(c,function(h){g.value(h).fire("change")},g.value())}}}c.addCommand("mceElysiaColor",function(){var g={forecolor:a("forecolor"),hilitecolor:a("hilitecolor")};var f=g;win=c.windowManager.open({title:"Text color",data:g,body:[{name:"forecolor",label:"Text color",type:"colorbox",onaction:b()},{name:"hilitecolor",label:"Background color",type:"colorbox",onaction:b()}],onPostRender:function(){},onSubmit:function(j){tinyMCE.elysiaColorLast={};for(var h in j.data){if(j.data[h]!=f[h]){d(h,j.data[h]);tinyMCE.elysiaColorLast[h]=j.data[h]}}},onselect:function(h){}})});c.addCommand("mceElysiaColorRepeat",function(){if(tinyMCE.elysiaColorLast){for(var f in tinyMCE.elysiaColorLast){d(f,tinyMCE.elysiaColorLast[f])}}});c.addButton("elysiacolor",{title:"Text color",tooltip:"Text color",cmd:"mceElysiaColor",icon:"mceElysiaColor"});c.addButton("elysiacolorrepeat",{title:"Ripeti ultimo colore",tooltip:"Ripeti ultimo colore",cmd:"mceElysiaColorRepeat",icon:"mceElysiaColorRepeat"})});